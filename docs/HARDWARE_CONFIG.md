# ğŸ“Š ç¡¬ä»¶è¿æ¥ä¸é…ç½®æŒ‡å—

## ğŸ”Œ ç¡¬ä»¶è¿æ¥å›¾

### ç³»ç»Ÿæ¶æ„å›¾
```
                    Tiaozhanbei2.0 ç³»ç»Ÿæ¶æ„
                           
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    USB 3.0    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                 â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ Intel RealSense  â”‚
    â”‚                 â”‚               â”‚ D455 ç›¸æœº        â”‚
    â”‚   è®¡ç®—æœº/PC     â”‚               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
    â”‚  (ä¸»æ§åˆ¶å™¨)     â”‚                        â”‚
    â”‚                 â”‚               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚                 â”‚    USB/ä¸²å£   â”‚   USBè½¬TTLæ¨¡å—   â”‚
    â”‚                 â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤  (é€šä¿¡è½¬æ¢å™¨)    â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚ UART
                                               â”‚ TX/RX/GND
                                               â–¼
                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                      â”‚  DJI RoboMaster  â”‚
                                      â”‚    Cå‹å¼€å‘æ¿     â”‚
                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                               â”‚
                                               â”‚ æ§åˆ¶ä¿¡å·
                                               â–¼
                                      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                      â”‚   æœºå™¨äººå¹³å°     â”‚
                                      â”‚  (ç§»åŠ¨åº•ç›˜/æœºæ¢°è‡‚) â”‚
                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### è¯¦ç»†è¿æ¥ç¤ºæ„å›¾
```
[PCç«¯å£åˆ†é…]
â”œâ”€â”€ USB 3.0 Port 1 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ RealSense D455
â”œâ”€â”€ USB 2.0 Port 2 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ USBè½¬TTLæ¨¡å—
â””â”€â”€ ç”µæºæ¥å£ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ å¤–éƒ¨ä¾›ç”µ (å¯é€‰)

[RealSense D455]
â”œâ”€â”€ USB 3.0 æ¥å£ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º PC USB 3.0
â”œâ”€â”€ ç”µæºæŒ‡ç¤ºç¯ (è“è‰²)
â””â”€â”€ å·¥ä½œæŒ‡ç¤ºç¯ (ç»¿è‰²)

[USBè½¬TTLæ¨¡å—]
â”œâ”€â”€ USBæ¥å£ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º PC USB 2.0  
â”œâ”€â”€ VCC (5V) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ä¸è¿æ¥ (Cæ¿è‡ªä¾›ç”µ)
â”œâ”€â”€ GND â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Cæ¿ GND
â”œâ”€â”€ TXD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Cæ¿ RX
â””â”€â”€ RXD â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Cæ¿ TX

[DJI RoboMaster Cæ¿]
â”œâ”€â”€ ç”µæºè¾“å…¥ (12V) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ æœºå™¨äººç”µæºç³»ç»Ÿ
â”œâ”€â”€ UARTæ¥å£ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ USBè½¬TTLæ¨¡å—
â”‚   â”œâ”€â”€ TX (PA9)
â”‚   â”œâ”€â”€ RX (PA10) 
â”‚   â””â”€â”€ GND
â”œâ”€â”€ CANæ¥å£ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ç”µæœºæ§åˆ¶å™¨
â””â”€â”€ GPIO â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ ä¼ æ„Ÿå™¨/æ‰§è¡Œå™¨
```

## âš™ï¸ ç¡¬ä»¶é…ç½®è¯¦è§£

### ğŸ¥ RealSense D455 é…ç½®

#### æ¥å£è§„æ ¼
- **è¿æ¥æ¥å£**: USB 3.0 Type-C
- **ä¾›ç”µæ–¹å¼**: USBæ€»çº¿ä¾›ç”µ (5V, æœ€å¤§900mA)
- **æ•°æ®ä¼ è¾“**: USB 3.0 SuperSpeed (5Gbps)

#### å®‰è£…ä½ç½®å»ºè®®
```
æ¨èå®‰è£…é«˜åº¦: 0.8m - 1.5m
æ°´å¹³è§†è§’è¦†ç›–: 87Â° Ã— 58Â°
æœ€ä½³æ£€æµ‹è·ç¦»: 0.5m - 3.0m
é¿å…å¼ºå…‰ç›´å°„å’Œåå…‰è¡¨é¢
```

#### å›ºå®šæ–¹æ¡ˆ
1. **ä¸‰è„šæ¶å›ºå®š**: æ ‡å‡†1/4è‹±å¯¸èºä¸æ¥å£
2. **æœºå™¨äººå®‰è£…**: ä½¿ç”¨å®˜æ–¹å®‰è£…æ”¯æ¶
3. **ä¸´æ—¶å›ºå®š**: å¤¹å…·æˆ–ç£æ€§åº•åº§

### ğŸ”— ä¸²å£é€šä¿¡é…ç½®

#### USBè½¬TTLæ¨¡å—é€‰æ‹©
| æ¨¡å—å‹å· | èŠ¯ç‰‡æ–¹æ¡ˆ | æ”¯æŒç³»ç»Ÿ | æ¨èåº¦ |
|---------|---------|----------|--------|
| CH340G  | CH340   | Win/Linux/Mac | â­â­â­â­ |
| CP2102  | Silicon Labs | Win/Linux/Mac | â­â­â­â­â­ |
| FT232RL | FTDI    | Win/Linux/Mac | â­â­â­â­â­ |
| PL2303  | Prolific | Win/Linux | â­â­â­ |

#### æ¥çº¿å¯¹ç…§è¡¨
| USBè½¬TTL | DJI Cæ¿ | ä¿¡å·è¯´æ˜ |
|----------|---------|----------|
| VCC      | ä¸è¿æ¥   | Cæ¿è‡ªä¾›ç”µ |
| GND      | GND     | å…¬å…±åœ°çº¿ |
| TXD      | RX (PA10) | æ•°æ®å‘é€ |
| RXD      | TX (PA9)  | æ•°æ®æ¥æ”¶ |

### ğŸ¤– DJI Cæ¿é…ç½®

#### ç¡¬ä»¶ç‰ˆæœ¬å…¼å®¹æ€§
- **DJI RoboMaster Cå‹å¼€å‘æ¿ V1.0**: âœ… å®Œå…¨æ”¯æŒ
- **DJI RoboMaster Cå‹å¼€å‘æ¿ V2.0**: âœ… å®Œå…¨æ”¯æŒ  
- **DJI RoboMaster Aå‹å¼€å‘æ¿**: âš ï¸ éœ€è¦ä¿®æ”¹é€šä¿¡åè®®

#### UARTé…ç½®å‚æ•°
```c
// Cæ¿ç«¯é…ç½®ç¤ºä¾‹
UART_InitTypeDef UART_InitStructure;
UART_InitStructure.UART_BaudRate = 115200;    // æ³¢ç‰¹ç‡
UART_InitStructure.UART_WordLength = UART_WordLength_8b;  // æ•°æ®ä½
UART_InitStructure.UART_StopBits = UART_StopBits_1;      // åœæ­¢ä½
UART_InitStructure.UART_Parity = UART_Parity_No;         // æ ¡éªŒä½
UART_InitStructure.UART_Mode = UART_Mode_Rx | UART_Mode_Tx;
```

## ğŸ”§ è½¯ä»¶é…ç½®ç¤ºä¾‹

### ç›¸æœºå‚æ•°é…ç½®
```python
# src/config.py - CameraConfigç±»
class CameraConfig:
    # === åŸºç¡€å‚æ•° ===
    width = 1280              # å›¾åƒå®½åº¦ (å¯é€‰: 640, 1280, 1920)
    height = 720              # å›¾åƒé«˜åº¦ (å¯é€‰: 480, 720, 1080)  
    fps = 30                  # å¸§ç‡ (å¯é€‰: 15, 30, 60)
    
    # === æ·±åº¦é…ç½® ===
    depth_scale = 0.001       # æ·±åº¦æ¯”ä¾‹ (mm -> m)
    depth_range = (0.2, 5.0)  # æœ‰æ•ˆæ·±åº¦èŒƒå›´ (ç±³)
    depth_unit = 0.001        # æ·±åº¦å•ä½ (æ¯«ç±³)
    
    # === å›¾åƒå¤„ç† ===
    enable_emitter = True     # å¯ç”¨çº¢å¤–å‘å°„å™¨
    laser_power = 150         # æ¿€å…‰åŠŸç‡ (0-360)
    accuracy = 2              # ç²¾åº¦ç­‰çº§ (1-3)
    
    # === æ»¤æ³¢å™¨é…ç½® ===
    spatial_filter = True     # ç©ºé—´æ»¤æ³¢å™¨
    temporal_filter = True    # æ—¶é—´æ»¤æ³¢å™¨
    hole_filling = True       # å­”æ´å¡«å……
    
    # === é«˜çº§å‚æ•° ===
    auto_exposure = True      # è‡ªåŠ¨æ›å…‰
    exposure_time = 8500      # æ›å…‰æ—¶é—´ (us)
    gain = 16                 # å¢ç›Šå€¼
```

### æœºå™¨äººé€šä¿¡é…ç½®
```python
# src/config.py - RobotConfigç±»  
class RobotConfig:
    # === ä¸²å£åŸºç¡€é…ç½® ===
    port = "COM3"             # Windowsä¸²å£å·
    # port = "/dev/ttyUSB0"   # Linuxä¸²å£å·
    # port = "/dev/tty.usbserial-0001"  # macOSä¸²å£å·
    
    baudrate = 115200         # æ³¢ç‰¹ç‡
    bytesize = 8              # æ•°æ®ä½
    parity = 'N'              # æ ¡éªŒä½ (N=æ— , E=å¶, O=å¥‡)
    stopbits = 1              # åœæ­¢ä½
    timeout = 1.0             # è¯»å–è¶…æ—¶ (ç§’)
    write_timeout = 1.0       # å†™å…¥è¶…æ—¶ (ç§’)
    
    # === é€šä¿¡åè®® ===
    command_frequency = 10    # æŒ‡ä»¤å‘é€é¢‘ç‡ (Hz)
    heartbeat_interval = 1.0  # å¿ƒè·³é—´éš” (ç§’)
    max_retries = 3           # æœ€å¤§é‡è¯•æ¬¡æ•°
    
    # === è¿åŠ¨é™åˆ¶ ===
    max_linear_speed = 1.0    # æœ€å¤§çº¿é€Ÿåº¦ (m/s)
    max_angular_speed = 1.0   # æœ€å¤§è§’é€Ÿåº¦ (rad/s)
    acceleration_limit = 2.0  # åŠ é€Ÿåº¦é™åˆ¶ (m/sÂ²)
    
    # === æ•°æ®æ ¼å¼ ===
    data_format = "json"      # æ•°æ®æ ¼å¼ (json/binary)
    enable_checksum = True    # å¯ç”¨æ ¡éªŒå’Œ
    little_endian = True      # å­—èŠ‚åº
```

### æ„ŸçŸ¥ç®—æ³•é…ç½®
```python
# src/config.py - PerceptionConfigç±»
class PerceptionConfig:
    # === ç®¡é“æ£€æµ‹å‚æ•° ===
    pipe_radius_range = (0.05, 0.5)     # ç®¡é“åŠå¾„èŒƒå›´ (ç±³)
    pipe_length_threshold = 1.0          # æœ€å°ç®¡é“é•¿åº¦ (ç±³)
    pipe_detection_method = "hough"      # æ£€æµ‹æ–¹æ³• (hough/contour/ml)
    
    # === æ³•å…°æ£€æµ‹å‚æ•° ===
    flange_radius_range = (0.1, 0.8)    # æ³•å…°åŠå¾„èŒƒå›´ (ç±³)
    circle_detection_threshold = 50      # åœ†æ£€æµ‹é˜ˆå€¼
    min_circle_distance = 0.3            # æœ€å°åœ†é—´è· (ç±³)
    
    # === RANSACå‚æ•° ===
    ransac_iterations = 1000             # è¿­ä»£æ¬¡æ•°
    ransac_threshold = 0.01              # è·ç¦»é˜ˆå€¼ (ç±³)
    ransac_min_samples = 100             # æœ€å°æ ·æœ¬æ•°
    
    # === æ»¤æ³¢å‚æ•° ===
    kalman_filter = True                 # å¯ç”¨å¡å°”æ›¼æ»¤æ³¢
    temporal_consistency = True          # æ—¶é—´ä¸€è‡´æ€§æ£€æŸ¥
    outlier_rejection = True             # å¼‚å¸¸å€¼å‰”é™¤
    
    # === ç‚¹äº‘å¤„ç† ===
    voxel_size = 0.01                    # ä½“ç´ å¤§å° (ç±³)
    statistical_outlier_removal = True   # ç»Ÿè®¡å¼‚å¸¸å€¼ç§»é™¤
    radius_outlier_removal = True        # åŠå¾„å¼‚å¸¸å€¼ç§»é™¤
```

## ğŸ” è°ƒè¯•ä¸æµ‹è¯•é…ç½®

### æ—¥å¿—çº§åˆ«é…ç½®
```python
# src/utils/logger.py
LOGGING_CONFIG = {
    'version': 1,
    'disable_existing_loggers': False,
    'formatters': {
        'detailed': {
            'format': '%(asctime)s [%(levelname)s] %(name)s: %(message)s'
        }
    },
    'handlers': {
        'console': {
            'class': 'logging.StreamHandler',
            'level': 'INFO',
            'formatter': 'detailed'
        },
        'file': {
            'class': 'logging.handlers.RotatingFileHandler',
            'filename': 'output/logs/tiaozhanbei.log',
            'maxBytes': 10485760,  # 10MB
            'backupCount': 5,
            'level': 'DEBUG',
            'formatter': 'detailed'
        }
    },
    'root': {
        'level': 'DEBUG',
        'handlers': ['console', 'file']
    }
}
```

### æ€§èƒ½ä¼˜åŒ–é…ç½®
```python
# é«˜æ€§èƒ½é…ç½®ç¤ºä¾‹
class HighPerformanceConfig:
    # é™ä½åˆ†è¾¨ç‡æé«˜å¸§ç‡
    camera_width = 640
    camera_height = 480
    camera_fps = 60
    
    # å‡å°‘å¤„ç†çº¿ç¨‹æ•°
    processing_threads = 2
    
    # ç¦ç”¨è€—æ—¶çš„æ»¤æ³¢å™¨
    spatial_filter = False
    temporal_filter = False
    
    # ç®€åŒ–ç®—æ³•å‚æ•°
    ransac_iterations = 500
    detection_roi = (100, 100, 440, 280)  # é™åˆ¶æ£€æµ‹åŒºåŸŸ
```

## ğŸ› ï¸ ç¯å¢ƒå˜é‡é…ç½®

### Windowsç¯å¢ƒå˜é‡
```cmd
:: è®¾ç½®Pythonè·¯å¾„
set PYTHONPATH=%PYTHONPATH%;F:\Tiaozhanbei2.0\src

:: è®¾ç½®OpenCVåç«¯
set OPENCV_DNN_BACKEND=CUDA

:: è®¾ç½®RealSenseæ—¥å¿—çº§åˆ«
set LIBREALSENSE_LOG_LEVEL=INFO
```

### Linux/Macç¯å¢ƒå˜é‡
```bash
# æ·»åŠ åˆ° ~/.bashrc æˆ– ~/.zshrc
export PYTHONPATH=$PYTHONPATH:/path/to/Tiaozhanbei2.0/src
export OPENCV_DNN_BACKEND=CUDA
export LIBREALSENSE_LOG_LEVEL=INFO

# ä¸²å£æƒé™ (Linux)
export SERIAL_DEVICE=/dev/ttyUSB0
sudo chmod 666 $SERIAL_DEVICE
```

## ğŸ“‹ é…ç½®æ£€æŸ¥æ¸…å•

### âœ… ç¡¬ä»¶æ£€æŸ¥
- [ ] RealSense D455 USB 3.0è¿æ¥æ­£å¸¸
- [ ] ç›¸æœºæŒ‡ç¤ºç¯æ­£å¸¸ (è“è‰²ç”µæºç¯ + ç»¿è‰²å·¥ä½œç¯)
- [ ] USBè½¬TTLæ¨¡å—æ­£ç¡®è¯†åˆ«
- [ ] DJI Cæ¿ä¸²å£é€šä¿¡æ­£å¸¸
- [ ] æœºå™¨äººå¹³å°ä¾›ç”µå……è¶³

### âœ… è½¯ä»¶æ£€æŸ¥  
- [ ] Python 3.8+ ç¯å¢ƒæ­£ç¡®å®‰è£…
- [ ] æ‰€æœ‰ä¾èµ–åŒ…å®‰è£…å®Œæˆ
- [ ] Intel RealSense SDK æ­£ç¡®å®‰è£…
- [ ] ä¸²å£é©±åŠ¨ç¨‹åºå®‰è£…
- [ ] é¡¹ç›®é…ç½®æ–‡ä»¶æ­£ç¡®è®¾ç½®

### âœ… åŠŸèƒ½æ£€æŸ¥
- [ ] è¿è¡Œ `python src/main.py --config-check` é€šè¿‡
- [ ] æ¼”ç¤ºæ¨¡å¼æ­£å¸¸è¿è¡Œ
- [ ] ç›¸æœºå›¾åƒæ˜¾ç¤ºæ­£å¸¸
- [ ] ä¸²å£é€šä¿¡æµ‹è¯•æˆåŠŸ
- [ ] ç®—æ³•æ£€æµ‹åŠŸèƒ½æ­£å¸¸

---

**ğŸ’¡ æç¤º**: å¦‚æœé‡åˆ°é…ç½®é—®é¢˜ï¼Œè¯·å‚è€ƒä¸»READMEæ–‡æ¡£çš„æ•…éšœæ’é™¤éƒ¨åˆ†ï¼Œæˆ–è¿è¡Œå®Œæ•´æ¼”ç¤ºè„šæœ¬è¿›è¡Œè‡ªåŠ¨æ£€æµ‹ã€‚
